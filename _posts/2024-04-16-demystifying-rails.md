---
# layout: posts
# author_profile: true
permalink: /demystifying-rails
title: Demystifying Rails - Ruby Oceania / AU Melbourne talk
excerpt: "How to learn and demystify rails"
# last_modified_at: 2016-11-03T11:13:12-04:00
collection: learning
categories:
  - software_engineering
  - learning
tags:
  - software_engineering
  - learning
  - talks
toc: true
# toc_sticky: true
# toc_label: "My Table of Contents"
# toc_icon: "cog"
# header:
#   video:
#     id: _mrF0pp8LIE
#     provider: youtube

---

# Action Plan

- how to demystify Ruby on Rails
- parts that form Rails
 	- bundler, rake, rack
 	- *Active*Support, *Active*Record, *Active*Model
 	- *Active*Mailer, *Active*Job
 	- **Action**Cable, **Action**Cable, **Action**Cable
 	- Routes, DSLs
- some demo code, my favourite parts

---

# About me

```ruby
class Friendlyantz
  def initialize
    @name = 'Anton Panteleev' || :friendlyantz
    @title = 'Extreme Programmer'
    @location = 'Melbourne, Australia'
    @work = FRESHOüå∂Ô∏è
  end
  
  def find_more = 'https://friendlyantz.me/'
  def twitter = 'https://twitter.com/friendlyantz/'
```

---

## Thailand

<img height="500" alt="image" src="https://github.com/friendlyantz/friendlyantz/assets/70934030/442c5a59-9abd-4df3-a02d-103d552a40ae">
<img height="500" alt="image" src="https://github.com/friendlyantz/friendlyantz/assets/70934030/d49db1de-4d0e-497f-bbda-1434d51ce9ec">
<img height="500" alt="image" src="https://github.com/friendlyantz/friendlyantz/assets/70934030/c55adaf5-b703-40ee-bd72-a7a6d7067818">

---
![fit_2048](https://github.com/friendlyantz/friendlyantz/assets/70934030/8eb5626b-bea8-4266-8966-e0803ff3fffb)

---

Ruby Conf AU - Sydney2024

<img height="500" alt="image" src="https://pbs.twimg.com/media/GK-BCCTawAAzlHT?format=jpg&name=large">
https://twitter.com/friendlyantz/status/1778782252035678544/photo/1

---

<img height="500" alt="image" src="https://pbs.twimg.com/media/GK-AOCWaAAA0zXP?format=jpg&name=large">
https://twitter.com/friendlyantz/status/1778781359248683376/photo/1

---

# Demystifying Rails

---

RubyConfTH 2022 - Dissecting Rails

> <https://www.youtube.com/watch?v=gXwRs-FwcmE>

---

key concepts
<img width="1003" alt="image" src="https://github.com/friendlyantz/friendlyantz/assets/70934030/b449d797-0b96-43b6-b05e-9f2170d7af6f">

---

# Bundler

```ruby
bundle exec [command]

bundle init # create Gemfile
bundle add [gemname] # it adds versions, so remove them if required
bundle remove [gemname]
bundle install
```

---

## Bundle more

```ruby
bundle show # show all gems in Gemfile
bundle show [gemname] # show path
bundle info [gemname]
bundle open [gemname] # open gem in editor

bundle console # open irb with gems loaded
# [DEPRECATED] bundle console will be replaced by `bin/console` generated by `bundle gem <name>`
```

---

# Rake

---

Rake is a build automation tool written in Ruby, similar to Make in Unix. 
However, Rake uses Ruby syntax, which allows for more flexibility and complexity in defining tasks.
- specify tasks 
- describe dependencies 
- group tasks in a namespace.

[free course by Avdi Grim](https://graceful.dev/courses/the-freebies/modules/rake-and-project-automation/topic/episode-129-rake/)

---

```ruby
task default: :create_files

directory 'ship_itüö¢'

task :touch => 'ship_itüö¢' do
  touch 'ship_itüö¢/file1.txt'
end
```

---

```ruby
task default: :html

files = Rake::FileList.new('**/*.md') do |fl|
  fl.exclude(/^excluded_dir/)
end

multitask html: files.ext('.html')

rule '.html' => '.md' do |t|
  sh "pandoc -o #{t.name} #{t.source}"
end
```

---

read more
```sh
ri FileUtils
```

---

# Rack

---

```ruby
# config.ru
run do |env|
  [200, { "some_header" => "lalala"}, ["Hello World"]]
end
```

```ruby
gem install rack
rackup # starts your default web server on 9292

# or specify alternative webserver, i.e. 'webrick'
rackup -s webrick
```

```sh
curl -i http://127.0.0.1:9292
```

---

# Active Support

---

## Core Ext

```ruby
require 'active_support'

# then
require 'active_support/core_ext/hash/indifferent_access'
# or
require 'active_support/core_ext'
```

---

```ruby
- `with_option`
- `try`
- `hash_with_indifferent_access`
- `in?`
- `prsenece` / `blank?` / `present?`
```

---
`presence` / `blank?` / `present?`
![image](https://github.com/friendlyantz/friendlyantz/assets/70934030/01430dd0-cc21-42fe-a007-58910a373bc7)

---

## Other Ext

- [`delegate`](https://guides.rubyonrails.org/active_support_core_extensions.html#delegate) and `delegate_missing_to`
```ruby
class User < ApplicationRecord
  has_one :profile

  delegate :name, to: :profile
end
```
- [squish](https://guides.rubyonrails.org/active_support_core_extensions.html#squish)
```ruby
" \n  foo\n\r \t bar \n".squish # => "foo bar"
```
- singularize, pluralize, camelize / underscore, titleize / dasherize, demodulize, deconstantize, parameterize, humanize, constantize

---

```ruby
"Admin::Hotel::ReservationUtils".demodulize # => "ReservationUtils"
1_234_567_890_123.to_fs(:human_size) # => 1.12 TB
1_234_567_890.to_fs(:human) # => "1.23 Billion"
(Date.today..Date.tomorrow).to_fs(:db) # => "BETWEEN '2009-10-25' AND '2009-10-26'"

%w(Earth Wind Fire).to_sentence # => "Earth, Wind, and Fire"
```

---

Ext to Enumerables

- pluck
- pick
- `many?`
- `index_by`
- including / excluding
- exclude?

----

Ext to Array

- extract
```ruby
numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
odd_numbers = numbers.extract! { |number| number.odd? } # => [1, 3, 5, 7, 9]
numbers # => [0, 2, 4, 6, 8]
```
-  `to`, `from`, `third`, `excluding`
- `.in_groups_of(3)`

----

## Extensions to Hash

- `deep_merge` / `merge` / `deep_dup`
- `except`
- `symbolize_keys` / `stringify_keys`

```ruby
{ a: 1, b: 1 }.merge(a: 0, c: 2)
```

---

# and my fav

`Array.forty_two`

```ruby
("A".."z").to_a.forty_two
=> "j"
# ("A".."z").to_a[41]
```

---

# ActiveRecord

---
ActiveRecord is essentially ActiveModel with persistence layer
```ruby
require 'active_record'

ActiveRecord::Base.establish_connection(
  adapter: 'sqlite3',
  database: 'sample.sqlite3'
)
```

---

```ruby
class CreateUsers < ActiveRecord::Migration[6.0]
  def change
    create_table :users do |t|
      t.string :name
    end
  end
end

CreateUsers.new.migrate(:up)
```

---

```ruby
class User < ActiveRecord::Base
  validates_presence_of :name, on: :create

  has_many :posts
end
```

---

- [ ] ActiveRecord
  - [ ] [basics](https://guides.rubyonrails.org/active_record_basics.html)
  - [ ] [migrations](https://guides.rubyonrails.org/active_record_migrations.html)
  - [ ] [validations](https://guides.rubyonrails.org/active_record_validations.html)
  - [ ] [callbacks](https://guides.rubyonrails.org/active_record_callbacks.html)
  - [ ] [Associations](https://guides.rubyonrails.org/association_basics.html)
  - [ ] [Query Interface](https://guides.rubyonrails.org/active_record_querying.html)

---

##¬†can't figure out what's causing a specific query in rails?
[look no further]([https://www.mayerdan.com/ruby/2022/06/27/rails-query-tracing](https://www.mayerdan.com/ruby/2022/06/27/rails-query-tracing))
```ruby
module ActiveRecord
  class LogSubscriber < ActiveSupport::LogSubscriber
    def sql(event)
      # NOTE: I add a global $ignore_query == false && if I need to say ignore all the factories or before/after spec specific queries to help
      # only find callers in application code.
      if /FROM "some_table" WHERE "some_condition"/.match?(event.payload[:sql])
        Rails.logger.info "SQL FOUND #{caller_locations[15...150]}" 
        binding.irb if ENV["QUERY_BINDING"]
        # or
        # require 'awesome_print' 
        # ap caller if ENV["QUERY_BINDING"]
      end
    end
  end
end

ActiveRecord::LogSubscriber.attach_to :active_record
```
---

# ActiveModel 


```ruby
	include ActiveModel::API
	include ActiveModel::AttributeMethods
	include ActiveModel::Model
	extend ActiveModel::Translation
	include ActiveModel::SecurePassword
```
---

# ActiveJob

---

# ActiveMailer

---

# References

1. https://github.com/friendlyantz/demystifying-rails
2. [RubyConfTH 2022 - Dissecting Rails Talk](https://www.youtube.com/watch?v=gXwRs-FwcmE) 
4. 