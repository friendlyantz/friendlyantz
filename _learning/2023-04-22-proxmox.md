---
layout: posts
# title: "Vi Everywhere"
permalink: /proxmox/
excerpt: "proxmox notes"
# last_modified_at: 2016-11-03T11:13:12-04:00
collection: learning
categories:
  - software_engineering
  - learning
tags:
  - software_engineering
  - learning
---

[Superb Tutorial, however I put some additional notes below](https://www.youtube.com/watch?v=LCjuiIswXGs&list=PLT98CRl2KxKHnlbYhtABg6cF50bYa8Ulo)

* Table of contents (do not remove this line)
{:toc}

## VM >>> Containers

* You can migrate VMs between clusters w/o shutting them down;
* Containers are more suitable if you have limited resources and are very efficient on RAM;
* Not all apps will run properly in containers;
* Some vendors have stigma against containers;

# Linux VM

I used [Debian](https://www.debian.org/download), other distros failed to install (Ubuntu server, Parrot OS Arch)

## 'Create New VM' Options:

- [ ] Disk: change Bus from SCSI to VirtIO Block (fastest) and enable 'Discard'
- [ ] CPU: type -> `host`

## Post Install:

- [ ] Unmount boot CD --> VM Hardware
- [ ] Install SSH
enable root access for users if you want
```sh
sudo usermod -aG sudo friendlyantz
```
- [ ] Enable QEMU Guest Agent - this will help with sending proper poweroff / exit commands from Proxmox to the VM: `sudo apt install qemu-guest-agent`; and enable it in Proxmox VM Options(restart required)

### Install ZeroTier
On vanilla Debian you need to sweat a bit and install a few packages, as this guys comes without `sudo`, `curl` or `git` to start with:
```sh
sudo apt update
sudo apt install git make curl build-essential
```
and then follow the [official instructions](https://www.zerotier.com/download.shtml) - git clone and try to `make` it:
But I am sure we don't have `make`, Rust `cargo`, `openssl` etc, so after `git clone`'ing ZT repo do the following:

```sh
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh # install Rust
apt install pkg-config
sudo apt-get install libssl-dev
# run Makefile finally
make
```

# Generic tips
- [ ] disable 'use tablet for pointer' if you don't use OS GUI --> VM Options
- [ ] Separate Proxmox management network from VM networks
- [ ] Enable start VM at boot if required --> Options
- [ ] VM a CD / iso to transfer files between machines (WIP)

# Photoprism

Ensure you change password for 1. Client and MarianDB from _insecure_ default password
Also when mounting volumes be explicit and state full path i.e. `/home/friendlyantz/Pictures/photoprism_originals` instead of `~/Pictures/photoprism_originals` as the latter can put `Pictures` forlder under `/root` instead of `/home/friendlyantz`
```yml
      - "/home/friendlyantz/Pictures/photoprism_originals:/photoprism/originals"               # Original media files (DO NOT REMOVE)
      - "/home/friendlyantz/Pictures/Archive:/photoprism/originals/archive" # *Additional* media folders can be mounted like this
```
Also, 1st line is for originals, 2nd for additional folders. Left side is your local path, right side is the path inside the container and will be displayed in UI are `/archive` in this case.
