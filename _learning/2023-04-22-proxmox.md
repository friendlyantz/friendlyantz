---
layout: posts
# title: "Vi Everywhere"
permalink: /proxmox/
excerpt: "proxmox notes"
# last_modified_at: 2016-11-03T11:13:12-04:00
collection: learning
categories:
  - software_engineering
  - learning
tags:
  - software_engineering
  - learning
---

[Superb Tutorial, however I put some additional notes below](https://www.youtube.com/watch?v=LCjuiIswXGs&list=PLT98CRl2KxKHnlbYhtABg6cF50bYa8Ulo)

* Table of contents (do not remove this line)
{:toc}

## VM >>> Containers

* You can migrate VMs between clusters w/o shutting them down;
* Containers are more suitable if you have limited resources and are very efficient on RAM;
* Not all apps will run properly in containers;
* Some vendors have stigma against containers;

# Linux VM

Highly recommend to run Ubuntu Server, as it has convenient way to enable SSH keys without password from the install and scrape those keys from the GitHub, you don't have to install essential packes like `sude`, `curl`, `git` like on Debian, and it has a nicer way to handle missing packages.
I used originally [Debian](https://www.debian.org/download), Parrot OS Arch distro failed to install.
Ubuntu server failed originally because i had BIOS boot mod enabled(which is default, make sure to chage it to UEFI when creating VM)

## 'Create New VM' Options:

- [ ] Disk: change Bus from SCSI to VirtIO Block (fastest) and enable 'Discard'
- [ ] Disk: change boot from BIOS to UEFI (Ubuntu Server wont work with BIOS, Debian will though)
- [ ] CPU: type -> `host`
- [ ] Netwrok: Model -> `Intel E1000` if it works for you, otherwise default

## Post Install:
- [ ] Unmount boot CD --> VM Hardware
- [ ] Install QEMU Guest Agent 
  ```sh
    sudo apt install qemu-guest-agent
    systemctl status qemu-guest-agent.service # check if running
    # -> enable in VM Options
    systemctl start qemu-guest-agent.service # if not running
    ```
### Install SSH 
enable root access for users if you want
```sh
sudo usermod -aG sudo friendlyantz
```
- [ ] Enable QEMU Guest Agent - this will help with sending proper poweroff / exit commands from Proxmox to the VM: `sudo apt install qemu-guest-agent`; and enable it in Proxmox VM Options(restart required)

### Install ZeroTier
```sh
curl -s 'https://raw.githubusercontent.com/zerotier/ZeroTierOne/master/doc/contact%40zerotier.com.gpg' | gpg --import && \
if z=$(curl -s 'https://install.zerotier.com/' | gpg); then echo "$z" | sudo bash; fi
```

# Generic tips
- [ ] disable 'use tablet for pointer' if you don't use OS GUI --> VM Options
- [ ] Separate Proxmox management network from VM networks
- [ ] Enable start VM at boot if required --> Options
- [ ] VM a CD / iso to transfer files between machines (WIP)

# Photoprism

Ensure you change password for 1. Client and MarianDB from _insecure_ default password
Also when mounting volumes be explicit and state full path i.e. `/home/friendlyantz/Pictures/photoprism_originals` instead of `~/Pictures/photoprism_originals` as the latter can put `Pictures` forlder under `/root` instead of `/home/friendlyantz`
```yml
      - "/home/friendlyantz/Pictures/photoprism_originals:/photoprism/originals"               # Original media files (DO NOT REMOVE)
      - "/home/friendlyantz/Pictures/Archive:/photoprism/originals/archive" # *Additional* media folders can be mounted like this
```
Also, 1st line is for originals, 2nd for additional folders. Left side is your local path, right side is the path inside the container and will be displayed in UI are `/archive` in this case.


# Networking / Firewall (WIP)

## Options and Considerations

1. Internet Router --> Managable Switch --> 
  - Server with PFSense AND  
  - Access Points for 
    - separate VLANs / PFSense tags --> Devices
    - Secure Net
    - Home Automation 
    - etc
2. Internet Router w/o switch
  - LAN to Proxmox with PFSense 
    - --> USB WiFi Dongle to use as Access Point for IoT devices
    - Normal internet / WiFi for Secure Net
3. Internet Router with VLANs
  - LAN to Proxmox with PFSense to tag VLANs
    - VLAN for IoT
    - VLAN for Secure Net
    - VLAN for Home Automation / etc

## PFsense in Proxmox
